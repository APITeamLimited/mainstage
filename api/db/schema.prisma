datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = "native"
}

// Define your own datamodels here and run `yarn redwood prisma migrate dev`
// to create migrations for them and apply to your dev DB.

// Make user model with UUID as primary key
model User {
  id             String           @id @default(uuid())
  firstName      String
  lastName       String
  email          String           @unique
  createdAt      DateTime         @default(now())
  updatedAt      DateTime?
  isSupport      Boolean          @default(false)
  emailVerified  Boolean          @default(false)
  shortBio       String?
  profilePicture String?
  memberships    TeamMembership[]

  // Password auth
  hashedPassword      String
  salt                String
  resetToken          String?
  resetTokenExpiresAt DateTime?
}

model Team {
  id                         String           @id @default(uuid())
  name                       String
  createdAt                  DateTime         @default(now())
  updatedAt                  DateTime?
  shortBio                   String?
  profilePicture             String?
  maxMembers                 Int              @default(10)
  memberships                TeamMembership[]
  invitations                TeamInvitation[]
  markedForDeletionToken     String?
  markedForDeletionExpiresAt DateTime?
}

model TeamMembership {
  id        String    @id @default(uuid())
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  team      Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)
  teamId    String
  role      String
}

model TeamInvitation {
  id        String    @id @default(uuid())
  createdAt DateTime  @default(now())
  updatedAt DateTime?
  email     String    @unique
  team      Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)
  teamId    String
  role      String
}
